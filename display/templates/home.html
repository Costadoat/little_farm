{% extends 'layout.html' %}

{% block title %}Jardin Erard{% endblock %}

{% block content %}
<h2>Mesures</h2>
<p class='{{class2}}'> Nous sommes le {{ maintenant.strftime('%A %d %B %Y') }}, il est
{{maintenant.strftime('%H:%M') }} et le dernier enregistrement date de
{{delta_last_record}} secondes ({{last_record.strftime('%H:%M')}}). </p>

<!--
<div class="container" class="progress" style="position: relative;">
<p> Remplissage du bac
  <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: {{remplissage}}%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">{{remplissage}}%</div>
</div>
-->

<div class="chart-container" style="position: relative;">

  <canvas id="canvas"></canvas>

</div>

<div class="chart-container" style="position: relative;">

  <canvas id="canvas2"></canvas>

</div>
<div class="chart-container" style="position: relative;">

  <canvas id="canvas3"></canvas>

</div>
<script>
  var config = {
    type: 'line',
    data: {
      labels: [ {% for item in labels %}
                  "{{ item.strftime('%d/%m %H:%M') }}",
                      {% endfor %}],
      datasets: [{% for dataset in datasets_temperature %}
      {
        label: "{{dataset.nom}}",
        backgroundColor: "{{dataset.backgroundColor}}",
        borderColor: "{{dataset.borderColor}}",
	pointRadius: "0",
        data: [{% for value in dataset.values %}
          {{value}},
          {% endfor %}
        ],
        fill: false,
      },
      {% endfor %}
    ]
    },
    options: {
      responsive: true,
      title: {
        display: true,
        text: 'Température/Humidité'
      },
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      scales: {
        xAxes: [{
          display: true,
          scaleLabel: {
            display: true,
            labelString: 'Date'
          }
        }],
        yAxes: [{
          display: true,
          scaleLabel: {
            display: true,
            labelString: 'Valeurs'
          }
        }]
      }
    }
  };
  var config2 = {
    type: 'line',
    data: {
      labels: [ {% for item in labels %}
                  "{{ item.strftime('%d/%m %H:%M') }}",
                      {% endfor %}],
      datasets: [{% for dataset in datasets_hygrometrie %}
      {
        label: "{{dataset.nom}}",
        backgroundColor: "{{dataset.backgroundColor}}",
        borderColor: "{{dataset.borderColor}}",
	pointRadius: "0",
        data: [{% for value in dataset.values %}
          {{value}},
          {% endfor %}
        ],
        fill: false,
      },
      {% endfor %}
    ]
    },
    options: {
      responsive: true,
      title: {
        display: true,
        text: 'Hygrométrie'
      },
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      scales: {
        xAxes: [{
          display: true,
          scaleLabel: {
            display: true,
            labelString: 'Date'
          }
        }],
        yAxes: [{
          display: true,
          ticks: {
              beginAtZero: true   // minimum value will be 0.
          },
          scaleLabel: {
            display: true,
            labelString: 'Valeur'
          }
        }]
      }
    }
  };
  var config3 = {
    type: 'line',
    data: {
      labels: [ {% for item in labels %}
                  "{{ item.strftime('%d/%m %H:%M') }}",
                      {% endfor %}],
      datasets: [{% for dataset in datasets_niveau %}
      {
        label: "{{dataset.nom}}",
        backgroundColor: "{{dataset.backgroundColor}}",
        borderColor: "{{dataset.borderColor}}",
	pointRadius: "0",
        data: [{% for value in dataset.values %}
          {{value}},
          {% endfor %}
        ],
        fill: false,
      },
      {% endfor %}
    ]
    },
    options: {
      responsive: true,
      title: {
        display: true,
        text: "Niveau d'eau"
      },
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      scales: {
        xAxes: [{
          display: true,
          scaleLabel: {
            display: true,
            labelString: 'Date'
          }
        }],
        yAxes: [{
          display: true,
          ticks: {
              beginAtZero: true   // minimum value will be 0.
          },
          scaleLabel: {
            display: true,
            labelString: 'Valeur'
          }
        }]
      }
    }
  };

  window.onload = function() {
    var ctx = document.getElementById('canvas').getContext('2d');
    window.myLine = new Chart(ctx, config);
    var ctx = document.getElementById('canvas2').getContext('2d');
    window.myLine = new Chart(ctx, config2);
    var ctx = document.getElementById('canvas3').getContext('2d');
    window.myLine = new Chart(ctx, config3);
      };

  document.getElementById('randomizeData').addEventListener('click', function() {
    config.data.datasets.forEach(function(dataset) {
      dataset.data = dataset.data.map(function() {
        return randomScalingFactor();
      });

    });

    window.myLine.update();
  });

  var colorNames = Object.keys(window.chartColors);
  document.getElementById('addDataset').addEventListener('click', function() {
    var colorName = colorNames[config.data.datasets.length % colorNames.length];
    var newColor = window.chartColors[colorName];
    var newDataset = {
      label: 'Dataset ' + config.data.datasets.length,
      backgroundColor: newColor,
      borderColor: newColor,
      data: [],
      fill: false
    };

    for (var index = 0; index < config.data.labels.length; ++index) {
      newDataset.data.push(randomScalingFactor());
    }

    config.data.datasets.push(newDataset);
    window.myLine.update();
  });

  document.getElementById('addData').addEventListener('click', function() {
    if (config.data.datasets.length > 0) {
      var month = MONTHS[config.data.labels.length % MONTHS.length];
      config.data.labels.push(month);

      config.data.datasets.forEach(function(dataset) {
        dataset.data.push(randomScalingFactor());
      });

      window.myLine.update();
    }
  });

  document.getElementById('removeDataset').addEventListener('click', function() {
    config.data.datasets.splice(0, 1);
    window.myLine.update();
  });

  document.getElementById('removeData').addEventListener('click', function() {
    config.data.labels.splice(-1, 1); // remove the label first

    config.data.datasets.forEach(function(dataset) {
      dataset.data.pop();
    });

    window.myLine.update();
  });
</script>
{% endblock %}
